data <- read.csv("data/input/raw_data.csv", sep = ";")

summary(data)
nrow(data)
anyNA(data)
colSums(is.na(data))
str(data)

# Convert categorical variables 
categorical_vars <- c("Marital.status", "Application.mode", "Application.order", 
                      "Course", "Previous.qualification", "Nacionality",
                      "Mother.s.qualification", "Father.s.qualification",
                      "Mother.s.occupation", "Father.s.occupation")

data[categorical_vars] <- lapply(data[categorical_vars], factor)

# Convert binary variables

# Then convert
binary_vars <- c("Daytime.evening.attendance.", "Displaced", 
                 "Educational.special.needs", "Debtor", 
                 "Tuition.fees.up.to.date", "Gender", 
                 "Scholarship.holder", "International")

data[binary_vars] <- lapply(data[binary_vars], factor)


# Convert Target to factor
data$Target <- factor(data$Target)

cat("\n=== Data Types After Conversion ===\n")
str(data)

cat("\n=== ANOVA F-Statistics for Individual Features ===\n")

numeric_cols <- sapply(data, is.numeric)

features <- names(data)[numeric_cols]

results <- data.frame(Feature=character(), F_value=numeric(), p_value=numeric(), stringsAsFactors=FALSE)

for(feat in features) {
  formula <- as.formula(paste(feat, "~ Target"))
  anova_result <- aov(formula, data=data)
  summary_anova <- summary(anova_result)
  f_val <- summary_anova[[1]]$`F value`[1]
  p_val <- summary_anova[[1]]$`Pr(>F)`[1]
  results <- rbind(results, data.frame(Feature=feat, F_value=round(f_val, 2), 
                                      p_value=format(p_val, scientific=TRUE)))
}

results <- results[order(-results$F_value),]
print(results, row.names=FALSE)

write.csv(data, "data/preprocessed_data.csv", row.names = FALSE)
